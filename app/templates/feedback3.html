{% extends "base.html" %}
{% block content %}

<head>
    <title>Chess</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chessboard-1.0.0.css') }}">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="{{ url_for('static', filename='js/chessboard-1.0.0.js') }}"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        .float-child {
            flex: 1;
        }  
       .float-container {
          display: flex;
        }
        .float-container:float-container{
            margin-right:20px;
        }
        body{
            background-color: rgb(5, 4, 19);
        }


        .dropbtn {
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .dropdown {
        position: relative;
        display: inline-block;
        }

        .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        }

        .dropdown-content li {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        }

        .dropdown-content a:hover {background-color: #f1f1f1}

        .dropdown:hover .dropdown-content {
        display: block;
        }

        .dropdown:hover .dropbtn {
        background-color: #3e8e41;
        }
      </style>
  </head>

  <body>
      <br>
      <h1>{{opening}}</h1>
      <h3 id = "selecttest">Select test with errors</h3>
      <h3 id = 'TestNumber'></h3>
      <h5 id = "mistakeNumber"></h5>

<<<<<<< HEAD
      <div id="myBoard" style="width: 400px; display:none",></div>
=======
  <div id="myBoard" style="width: 400px; display:none",></div>
  <button id="Pos" style = "display:none">Show Position</button>
  <button id="Mistake" style=  "display:none">Mistake</button>
  <button id="correct" style = "display:none">Correct Move</button>
  <button id = "next" style = "display:none">Next</button>
  <button id = "back" style = "display:none">Back</button>
  <button id = "newtest" style = "display:none">Select New Test</button>
  <p id = "feedback"></p>
>>>>>>> 5810552e066b37eaf0d8b11e1c0e3f71b36427a9

      <button id="Pos" style = "display:none">Show Position</button>
      <button id="Mistake" style=  "display:none">Mistake</button>
      <button id="correct" style = "display:none">Correct Move</button>
      <button id = "next" style = "display:none">Next</button>
      <button id = "back" style = "display:none">Back</button>
      <button id = "newtest" style = "display:none">Select New Test</button>

      <div class="dropdown">
        <button class="dropbtn">Dropdown</button>
        <div id="foo" class="dropdown-content"></div>
      </div>


      <button id = "newopening"><a href = "{{ url_for('feedback2') }}">Choose new opening</a></button>

      <hr>

      <!--Search chart.js documentation to style the chart. the location is base.html-->
      <div class="container" style="background-color: white;">
          <canvas id = "myChart"></canvas>
      </div>

  </body>


  <script>
  var black = "{{opening}}".split(' ')[1]

  if (black == "Defense"){
     var is_black = "True";
  } else {
      var is_black = "False";                              
  }



  x = {{mistakes|safe}}
  feedback = {{feedback|safe}}
  for (var i = 0; i<x.length; i++){
      if (x[i] == ""){
          x.splice(i,1)
          feedback.splice(i,1)
      }
  }

  console.log("this is feedback: " + feedback);

  var Test
  function makeUL(array) {
    // Create the list element:
    var list = document.createElement('ul');
    list.id = 'list';

    for (var i = 0; i < x.length; i++) {
        console.log(feedback[i])
        // console.log('{{mistakes[i]}}')
        // Create the list item:
        var item = document.createElement('li');
        item.id = i;
        item.onclick = function (){
             Test = this.id
             document.getElementById('list').style.display = "none";
             testnum = parseInt(this.id) + 1
             document.getElementById('TestNumber').innerHTML = "Test number" + " " + testnum;
             document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + 1;
             document.getElementById('myBoard').style.display = "block";
             document.getElementById('Pos').style.display = "block";
             document.getElementById('Mistake').style.display = "block";
             document.getElementById('correct').style.display = "block";
             document.getElementById('newtest').style.display = "block";
             document.getElementById("selecttest").style.display = "none";
             document.getElementById('newopening').style.display = "none"
             if (x[parseInt(Test)].length > 1){
             document.getElementById('next').style.display = "block";
             }
             document.getElementById("myChart").style.display = "none";
             document.getElementById('feedback').innerHTML = feedback[this.id];
            //  document.getElementById('back').style.display = "block";
                

             
             

        }

        // Set its contents:
        item.appendChild(document.createTextNode(i+1));


        // Add it to the list:
        list.appendChild(item);
    }

    // Finally, return the constructed list:
    return list;
}



// Add the contents of options[0] to #foo:
document.getElementById('foo').appendChild(makeUL('{{mistakes}}'));

var i = 0

board = Chessboard('myBoard')
    

    $('#Pos').on('click', function () {
    if (is_black == 'False'){
        board.position(x[parseInt(Test)][i].split(',')[0])}
    else {
        board.position(x[parseInt(Test)][i].split(',')[0])
        board.orientation('black')
    }

    }
    )

    $('#Mistake').on('click', function () {
    if (is_black == 'False'){
    board.position(board.position(x[parseInt(Test)][i].split(',')[1]))}
    else {
    board.position(board.position(x[parseInt(Test)][i].split(',')[1]))
    board.orientation('black')}

    }
    )

    $('#correct').on('click', function () {
    if (is_black == 'False'){
    board.position(board.position(x[parseInt(Test)][i].split(',')[2]))}
    else {
    board.position(board.position(x[parseInt(Test)][i].split(',')[2]))
    board.orientation('black')}

    }
    )


$('#next').on('click', function () {
board.position(board.position('start'))
console.log(x[parseInt(Test)].length - 1)
var mistakesmade = x[parseInt(Test)].length - 1
i = i + 1
if (i<mistakesmade) {
    document.getElementById('back').style.display = "block";

    

    document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(i + 1);
    console.log(i)
    } else if ( i ==mistakesmade) {
        document.getElementById('next').style.display = "none";
        document.getElementById('back').style.display = "block";

        document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(i + 1);

    }
    else {
        document.getElementById('next').style.display = "none";
        document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(i + 1);


    }  
})

$('#back').on('click', function () {
board.position(board.position('start'))
// document.getElementById('next').style.display = "block";

var mistakesmade = x[parseInt(Test)].length -1
if (i<=mistakesmade && i>0) {
    document.getElementById('next').style.display = "block";

    i = i - 1
    console.log(i)
    if (i != 0){
    document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(i + 1);
    } else {    document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(1) ;
    document.getElementById('back').style.display = "none";

}
    } else {
        document.getElementById('back').style.display = "none";
        if (i != 0){
        document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + parseInt(document.getElementById('mistakeNumber').innerHTML) -1 ;
    } else {    document.getElementById('mistakeNumber').innerHTML = "Mistake Number " + 1 ;
}

    }  
})

$('#newtest').on('click', function () {
    i = 0;
    document.getElementById('list').style.display = "block";
    document.getElementById('TestNumber').innerHTML = "";
    document.getElementById('mistakeNumber').innerHTML = "";
    document.getElementById('myBoard').style.display = "none";
    document.getElementById('Pos').style.display = "none";
    document.getElementById('Mistake').style.display = "none";
    document.getElementById('correct').style.display = "none";
    document.getElementById('next').style.display = "none";
    document.getElementById('back').style.display = "none";
    document.getElementById('back').style.display = "none";
    document.getElementById('newtest').style.display = "none";
    document.getElementById("selecttest").style.display = "block";
    document.getElementById('newopening').style.display = "block";
    document.getElementById('myChart').style.display = "block";
    document.getElementById('feedback').innerHTML = "";



})



let myChart = document.getElementById('myChart').getContext('2d');

let lineChart = new Chart(myChart, {
    type: 'line', 
    data: {
        labels: {{attempt}},
        datasets: [{
            label: 'Grades',
            data: {{grades}}
        }]
    },
    options: {
        plugins: {
        title: {
            display: true,
            text: '{{opening}} Attempts'
        }
        },
        scales: {
            y: {
              
                beginAtZero: true,
                title: {
                    display: true,
                    text: "Grade"
                }
            },
            x: {
                title: {
                    display: true,
                    text: "Attempt Number"
                }
            }
        }
    }
    
    //   }
 
});









  




  </script>

{% include 'footer.html' %}
{% endblock %}